# 反向代理
使用场景：
- 不想暴露真实服务器的地址
- 通过代理服务器，访问速度慢的网站

## 基本用法配置
通过访问rocky的443端口去访问ubuntu的80页面  

rocky
```
$ vim 123.com.conf

    server {
        listen       443 ssl;
        server_name  www.123.com;
        error_log /usr/local/nginx/logs/123.error.log notice;
        access_log /usr/local/nginx/logs/123.access.log main;
        ssl_certificate ssl/server.crt;
        ssl_certificate_key ssl/server.key;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ALL:!DH:!EXPORT:!RC4:+HIGH:+MEDIUM:!eNULL;
        ssl_prefer_server_ciphers on;

        location / {
        proxy_pass http://192.168.119.201/;
        proxy_set_header Host   $host;
        proxy_set_header X-Real-IP      $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
   }
```
解析:
- `proxy_pass http://192.168.119.201/`：真正服务器的IP地址
- `proxy_set_header Host $host`：$host就是域名server_name www.123.com
- `proxy_set_header X-Real-IP $remote_addr`：客户端的真实IP地址
- `proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for`：代理服务器的IP地址
- `proxy_set_header X-Real-IP $remote_addr`和`proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for`这两条配合真实服务器`combined_realip`日志格式，方便查看真实请求进来的ip地址

ubuntu中  
可在`nginx.conf`中定义[combined_realip格式的访问日志](https://linyi.readthedocs.io/zh/latest/%E6%9C%8D%E5%8A%A1/Nginx/%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6.html#id3)，然后在server块中指定，以获取客户端的真实IP地址。